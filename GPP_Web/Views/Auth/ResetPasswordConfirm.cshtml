@model GPP_Web.DTOs.User.ResetPasswordConfirmDTO

@{
    ViewData["Title"] = "Confirmar Restablecimiento de Contraseña";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/rolerequest.css">

<div class="form-container">
    <div class="form-card">
        <!-- Título y Imagen -->
        <div class="header-section">
            <h3 class="title">Restablecer Contraseña</h3>
            <p class="text-muted">Introduce tu nueva contraseña y confírmala.</p>
            <img src="~/images/imgs/undraw_reset_password.svg" alt="Restablecer Contraseña" class="img-fluid" />
        </div>

        <!-- Formulario de confirmación -->
        <form method="post" id="resetPasswordForm" onsubmit="return validatePasswords()">
            @Html.AntiForgeryToken()

            <input type="hidden" name="Email" value="@ViewData["Email"]" />
            <input type="hidden" name="Token" value="@ViewData["Token"]" />

            <!-- Nueva Contraseña -->
            <div class="flex-column">
                <label asp-for="NewPassword" class="form-label fs-6">Nueva Contraseña</label>
                <div class="inputForm">
                    <input asp-for="NewPassword" class="input" type="password" id="NewPassword" placeholder="Introduce tu nueva contraseña" />
                </div>
                <span asp-validation-for="NewPassword" class="text-danger mt-1 d-block"></span>
            </div>

            <!-- Confirmación de Nueva Contraseña -->
            <div class="flex-column">
                <label asp-for="ConfirmNewPassword" class="form-label fs-6">Confirmar Nueva Contraseña</label>
                <div class="inputForm">
                    <input asp-for="ConfirmNewPassword" class="input" type="password" id="ConfirmNewPassword" placeholder="Confirma tu nueva contraseña" />
                </div>
                <span asp-validation-for="ConfirmNewPassword" class="text-danger mt-1 d-block"></span>
            </div>

            <button type="submit" class="button-submit">Restablecer Contraseña</button>
        </form>
    </div>
</div>

<!-- Modal de Éxito -->
<div class="modal" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">¡Éxito!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tu solicitud de restablecimiento de contraseña ha sido completada con éxito.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Error -->
<div class="modal" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">¡Error!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Algo salió mal al intentar restablecer tu contraseña. Por favor, intenta de nuevo.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Función para validar las contraseñas en el frontend
        function validatePasswords() {
            var newPassword = document.getElementById("NewPassword").value;
            var confirmNewPassword = document.getElementById("ConfirmNewPassword").value;

            // Verificamos si las contraseñas coinciden
            if (newPassword !== confirmNewPassword) {
                // Mostramos el modal de error si las contraseñas no coinciden
                $('#errorModal').modal('show');
                return false;  // No enviamos el formulario
            }

            return true;  // Si las contraseñas coinciden, enviamos el formulario
        }

        // Mostrar modal de éxito si el mensaje de éxito está presente
        @if (ViewBag.SuccessMessage != null)
        {
                <text>
                    $(document).ready(function() {
                        $('#successModal').modal('show');
                    });
                </text>
        }

        // Mostrar modal de error si el mensaje de error está presente
        @if (ViewBag.ErrorMessage != null)
        {
                <text>
                    $(document).ready(function() {
                        $('#errorModal').modal('show');
                    });
                </text>
        }
    </script>
}
